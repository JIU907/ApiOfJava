## 第五章 基础构建模块

```
将线程安全性交给线程安全类
*：一个线程的执行过程中，所操作的对象如果是线程安全类的对象，那就不存在线程安全问题
```

### 5.1 同步安全容器

```
*：使用同步安全容器，重要的地方在于，当操作这个容器时是线程安全的
   但是这个容器内的对象未必是安全的
*：使用这种方式只能保证通过该容器操作内部对象是线程安全
   即每次只有一个线程能访问该容器的状态
```

**同步安全容器的问题**

```
复合操作下，线程安全，但并不是想要的结果
Code: T01_SynchronizedContainerQuestion
```

### 5.2 并发容器

- 同步容器：将所有对容器状态的访问都进行串行化操作
    - 高安全性，低并发性
- 并发容器：针对多个线程并发访问进行的操作
    - 在保证安全性的情况下，提高并发性

**ConcurrentHashMap**

- HashTable与synchronized中对容器的状态访问会进行申请独占锁
- ConcurrentHashMap是使用分段锁进行控制，粒度更小
    - 参见11.4.3节
- ConcurrentHashMap的迭代器，可以(不是保证！)在迭代器被构造后将修改操作反映给容器

**CopyOnWriteArrayList**

- 用来替代同步的List，提供了更好的同步性
    - add时，加同步代码块锁，获取当前数组的副本，设置新值后保存副本
    - get时，返回最新的元素数组副本

